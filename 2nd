# Import libraries
import math
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn import linear_model
from mpl_toolkits.mplot3d import Axes3D

# Load the data
df = pd.read_csv("data.csv")

# Handle missing values
median_room = math.floor(df['room'].median())
df['room'] = df['room'].fillna(median_room)

# Prepare X and y
X = df[['area', 'room', 'age']]   # Features
Y = df['price']                  # Target

# Train the model
reg = linear_model.LinearRegression()
reg.fit(X, Y)

# Make predictions
y_pred = reg.predict(X)

# Display coefficients
print("Coefficients:", reg.coef_)
print("Intercept:", reg.intercept_)

# Predict a new value
new_prediction = reg.predict([[2000, 4, 10]])[0]
print("Prediction for [2000 sq ft, 4 rooms, 10 years old]:", new_prediction)

# Plotting the 3D Graph
fig = plt.figure(figsize=(14, 8))
ax = fig.add_subplot(111, projection='3d')

# Scatter actual data
sc = ax.scatter(df['area'], df['room'], df['price'], 
                c=df['age'], cmap='viridis', s=100, alpha=0.9, 
                edgecolors='black', label='Actual Data')

# Color bar
cbar = plt.colorbar(sc)
cbar.set_label('Age (years)', fontsize=12)

# Create mesh grid for regression plane
area_range = np.linspace(df['area'].min(), df['area'].max(), 20)
room_range = np.linspace(df['room'].min(), df['room'].max(), 20)
area_mesh, room_mesh = np.meshgrid(area_range, room_range)

# Predict price for the meshgrid
age_mean = df['age'].mean()
price_plane = reg.predict(np.c_[area_mesh.ravel(), room_mesh.ravel(), np.full(area_mesh.ravel().shape, age_mean)])
price_plane = price_plane.reshape(area_mesh.shape)

# Plot regression plane
ax.plot_surface(area_mesh, room_mesh, price_plane, cmap='plasma', alpha=0.6, edgecolor='none')

# Labels and title
ax.set_xlabel('Area (sq ft)', fontsize=12, labelpad=15)
ax.set_ylabel('Rooms', fontsize=12, labelpad=15)
ax.set_zlabel('Price', fontsize=12, labelpad=15)
ax.set_title('Multiple Linear Regression', fontsize=18, fontweight='bold')

# Adjust viewing angle
ax.view_init(elev=25, azim=135)

# Show plot
plt.show()
